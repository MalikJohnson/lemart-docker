import{a as G}from"./chunk-NUAVFZCM.js";import{a as Y}from"./chunk-KADWM4CG.js";import{a as J}from"./chunk-3HUNMAGN.js";import{a as H}from"./chunk-TNLYEMQX.js";import{h as Z}from"./chunk-OZSZ3DCI.js";import{i as L,j as N,o as q}from"./chunk-ICKQEOCD.js";import{C as A,L as D,m as F,p as U,q as W,v as R,x as V,z}from"./chunk-66TIHPRD.js";import{Db as O,Eb as m,Mb as n,Nb as p,O as M,Pb as j,Qb as B,Ra as d,Rb as g,Sb as y,Tb as S,Xa as c,Yb as f,Zb as v,a as C,ab as w,b,ga as E,gb as h,ha as T,m as x,nb as s,q as _,sb as t,tb as i,ub as I,w as k,yb as P}from"./chunk-J2LCUAOM.js";function Q(a,o){a&1&&(t(0,"div",20)(1,"div",21)(2,"span",22),n(3,"Loading..."),i()()())}function X(a,o){if(a&1&&(t(0,"p",23),n(1),i()),a&2){let e=m(2);d(),p(e.userInfo.address)}}function $(a,o){if(a&1&&(t(0,"p",23),n(1),i()),a&2){let e=m(2);d(),B(" ",e.userInfo.city,", ",e.userInfo.state," ",e.userInfo.zipCode," ")}}function ee(a,o){if(a&1&&(t(0,"div")(1,"p",23)(2,"strong"),n(3),i()(),t(4,"p",23),n(5),i(),h(6,X,2,1,"p",24)(7,$,2,3,"p",24),t(8,"button",25),n(9," Edit Information "),i()()),a&2){let e=m();d(3),j("",e.userInfo.firstName," ",e.userInfo.lastName,""),d(2),p(e.userInfo.email),d(),s("ngIf",e.userInfo.address),d(),s("ngIf",e.userInfo.city||e.userInfo.state||e.userInfo.zipCode)}}function te(a,o){a&1&&I(0,"span",32)}function ie(a,o){if(a&1){let e=P();t(0,"div")(1,"div",26)(2,"span"),n(3,"Subtotal"),i(),t(4,"span"),n(5),f(6,"currency"),i()(),t(7,"div",26)(8,"span"),n(9,"Shipping"),i(),t(10,"span"),n(11),f(12,"currency"),i()(),t(13,"div",26)(14,"span"),n(15,"Tax"),i(),t(16,"span"),n(17),f(18,"currency"),i()(),I(19,"hr"),t(20,"div",27)(21,"span",28),n(22,"Total"),i(),t(23,"span",29),n(24),f(25,"currency"),i()(),t(26,"button",30),O("click",function(){E(e);let u=m();return T(u.placeOrder())}),h(27,te,1,0,"span",31),n(28," Place Order "),i()()}if(a&2){let e=m();d(5),p(v(6,6,e.subtotal)),d(6),p(v(12,8,e.shipping)),d(6),p(v(18,10,e.tax)),d(7),p(v(25,12,e.total)),d(2),s("disabled",e.loading||e.cartItems.length===0),d(),s("ngIf",e.loading)}}function re(a,o){a&1&&(t(0,"div",20)(1,"p",33),n(2,"Your cart is empty"),i(),t(3,"button",34),n(4,"Continue Shopping"),i()())}var K=class a{constructor(o,e,r,u,l,ne,oe){this.cartService=o;this.userService=e;this.orderService=r;this.authService=u;this.router=l;this.toastr=ne;this.productService=oe}userInfo={};cartItems=[];loading=!1;paymentMethod="credit_card";subtotal=0;shipping=0;taxRate=.07;tax=0;total=0;freeShippingThreshold=50;ngOnInit(){this.loadUserInfo(),this.loadCartItems()}loadUserInfo(){this.loading=!0;let o=this.authService.getUserId();this.userService.getUserById(o).subscribe({next:e=>{this.userInfo=e,this.loading=!1},error:e=>{console.error("Error loading user info",e),this.loading=!1,this.toastr.error("Failed to load user information")}})}loadCartItems(){this.loading=!0,this.cartService.cart$.pipe(M(o=>o.length===0?x([]):k(o.map(e=>this.productService.getById(e.productId).pipe(_(r=>b(C({},e),{product:r}))))))).subscribe({next:o=>{this.cartItems=o,this.calculateTotals(),this.loading=!1},error:o=>{console.error("Error loading cart items",o),this.loading=!1,this.toastr.error("Failed to load cart items")}})}calculateTotals(){this.subtotal=this.cartItems.reduce((o,e)=>o+e.product.price*e.quantity,0),this.shipping=this.subtotal>=this.freeShippingThreshold?0:5.99,this.tax=parseFloat((this.subtotal*this.taxRate).toFixed(2)),this.total=parseFloat((this.subtotal+this.shipping+this.tax).toFixed(2))}placeOrder(){if(!this.authService.hasValidToken()){this.toastr.error("Please log in to complete your order"),this.router.navigate(["/login"],{queryParams:{returnUrl:"/checkout"}});return}this.loading=!0;let o=this.authService.getUserId(),e=this.cartItems.map(r=>({productId:r.product.id,quantity:r.quantity,currentPrice:r.product.price}));this.orderService.convertCartToOrder(o,e,this.subtotal,this.tax,this.shipping,this.total).subscribe({next:r=>{this.loading=!1,this.cartService.clearCart(),this.toastr.success("Order placed successfully!"),this.router.navigate(["/order-confirmation",r.id])},error:r=>{console.error("Error placing order",r),this.loading=!1,this.toastr.error("Failed to place order. Please try again."),r.status===401&&(this.authService.logout(),this.router.navigate(["/login"]))}})}static \u0275fac=function(e){return new(e||a)(c(J),c(G),c(H),c(q),c(L),c(Z),c(Y))};static \u0275cmp=w({type:a,selectors:[["app-checkout"]],decls:36,vars:7,consts:[[1,"container","py-5"],[1,"row"],[1,"col-lg-8"],[1,"card","mb-4"],[1,"card-header","bg-primary","text-white"],[1,"mb-0"],[1,"card-body"],[1,"mb-3"],[1,"mb-4","p-3","border","rounded"],["class","text-center py-3",4,"ngIf"],[4,"ngIf"],[1,"form-check","mb-2"],["type","radio","name","paymentMethod","id","creditCard","value","credit_card","checked","",1,"form-check-input",3,"ngModelChange","ngModel"],["for","creditCard",1,"form-check-label"],["type","radio","name","paymentMethod","id","paypal","value","paypal",1,"form-check-input",3,"ngModelChange","ngModel"],["for","paypal",1,"form-check-label"],[1,"form-check"],["type","radio","name","paymentMethod","id","zelle","value","zelle",1,"form-check-input",3,"ngModelChange","ngModel"],["for","zelle",1,"form-check-label"],[1,"col-lg-4"],[1,"text-center","py-3"],["role","status",1,"spinner-border","spinner-border-sm","text-primary"],[1,"visually-hidden"],[1,"mb-1"],["class","mb-1",4,"ngIf"],["routerLink","/profile",1,"btn","btn-sm","btn-outline-primary","mt-2"],[1,"d-flex","justify-content-between","mb-2"],[1,"d-flex","justify-content-between","mb-3"],[1,"fw-bold"],[1,"fw-bold","fs-5"],[1,"btn","btn-primary","w-100",3,"click","disabled"],["class","spinner-border spinner-border-sm","role","status","aria-hidden","true",4,"ngIf"],["role","status","aria-hidden","true",1,"spinner-border","spinner-border-sm"],[1,"text-muted"],["routerLink","/",1,"btn","btn-outline-primary"]],template:function(e,r){e&1&&(t(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"h5",5),n(6,"Checkout"),i()(),t(7,"div",6)(8,"h5",7),n(9,"Contact Information"),i(),t(10,"div",8),h(11,Q,4,0,"div",9)(12,ee,10,5,"div",10),i(),t(13,"h5",7),n(14,"Payment Method"),i(),t(15,"div",8)(16,"div",11)(17,"input",12),S("ngModelChange",function(l){return y(r.paymentMethod,l)||(r.paymentMethod=l),l}),i(),t(18,"label",13),n(19," Credit/Debit Card "),i()(),t(20,"div",11)(21,"input",14),S("ngModelChange",function(l){return y(r.paymentMethod,l)||(r.paymentMethod=l),l}),i(),t(22,"label",15),n(23," PayPal "),i()(),t(24,"div",16)(25,"input",17),S("ngModelChange",function(l){return y(r.paymentMethod,l)||(r.paymentMethod=l),l}),i(),t(26,"label",18),n(27," Zelle "),i()()()()()(),t(28,"div",19)(29,"div",3)(30,"div",4)(31,"h5",5),n(32,"Order Summary"),i()(),t(33,"div",6),h(34,ie,29,14,"div",10)(35,re,5,0,"div",9),i()()()()()),e&2&&(d(11),s("ngIf",r.loading),d(),s("ngIf",!r.loading&&r.userInfo),d(5),g("ngModel",r.paymentMethod),d(4),g("ngModel",r.paymentMethod),d(4),g("ngModel",r.paymentMethod),d(9),s("ngIf",r.cartItems.length>0),d(),s("ngIf",r.cartItems.length===0))},dependencies:[W,F,U,D,R,A,V,z,N],encapsulation:2})};export{K as CheckoutComponent};
