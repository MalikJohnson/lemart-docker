import{a as Q}from"./chunk-3FZJDB7L.js";import{h as $}from"./chunk-PMZGBCKH.js";import{i as w,m as D,o as X}from"./chunk-CMEXFVJG.js";import{A as j,D as B,E as K,F as W,G as H,H as Y,K as Z,M as J,k as M,l as O,m as U,q as k,v as z,w as p,x as G,y as R}from"./chunk-66TIHPRD.js";import{Db as A,Eb as x,Mb as l,Nb as I,Qb as q,Ra as a,Wb as b,Xa as F,ab as V,ga as N,gb as u,ha as T,nb as m,sb as n,tb as t,ub as E,yb as L}from"./chunk-J2LCUAOM.js";var P=r=>({"is-invalid":r});function te(r,o){r&1&&(n(0,"div",10)(1,"div",11)(2,"span",12),l(3,"Loading..."),t()(),n(4,"p",13),l(5,"Loading profile data..."),t()())}function ie(r,o){if(r&1&&(n(0,"p",18),l(1),t()),r&2){let i=x(2);a(),I(i.user.streetAddress)}}function re(r,o){if(r&1){let i=L();n(0,"div",14)(1,"div",15)(2,"h5",16),l(3,"Username"),t(),n(4,"p",17),l(5),t()(),n(6,"div",15)(7,"h5",16),l(8,"Email"),t(),n(9,"p",18),l(10),t()(),n(11,"div",15)(12,"h5",16),l(13,"Address"),t(),u(14,ie,2,1,"p",19),n(15,"p",18),l(16),t()(),n(17,"div",20)(18,"button",21),A("click",function(){N(i);let d=x();return T(d.startEditing())}),l(19," Edit Profile "),t()()()}if(r&2){let i=x();a(5),I(i.user.username),a(5),I(i.user.email),a(4),m("ngIf",i.user.streetAddress),a(2),q("",i.user.city,", ",i.user.state," ",i.user.zipCode,"")}}function ne(r,o){r&1&&(n(0,"div",37),l(1," Username is required "),t())}function le(r,o){r&1&&(n(0,"div",37),l(1," Username must be at least 3 characters "),t())}function oe(r,o){r&1&&(n(0,"div",37),l(1," Email is required "),t())}function ae(r,o){r&1&&(n(0,"div",37),l(1," Please enter a valid email address "),t())}function me(r,o){r&1&&(n(0,"div",37),l(1," City is required "),t())}function se(r,o){if(r&1&&(n(0,"option",38),l(1),t()),r&2){let i=o.$implicit;m("value",i),a(),I(i)}}function de(r,o){r&1&&(n(0,"div",37),l(1," State is required "),t())}function ue(r,o){r&1&&(n(0,"div",37),l(1," Zip code is required "),t())}function pe(r,o){if(r&1){let i=L();n(0,"form",22),A("ngSubmit",function(){N(i);let d=x();return T(d.saveProfile())}),n(1,"div",15)(2,"label",23),l(3,"Username"),t(),E(4,"input",24),u(5,ne,2,0,"div",25)(6,le,2,0,"div",25),t(),n(7,"div",15)(8,"label",23),l(9,"Email"),t(),E(10,"input",26),u(11,oe,2,0,"div",25)(12,ae,2,0,"div",25),t(),n(13,"div",15)(14,"label",23),l(15,"Street Address"),t(),E(16,"input",27),t(),n(17,"div",1)(18,"div",28)(19,"label",23),l(20,"City"),t(),E(21,"input",29),u(22,me,2,0,"div",25),t(),n(23,"div",30)(24,"label",23),l(25,"State"),t(),n(26,"select",31)(27,"option",32),l(28,"Select State"),t(),u(29,se,2,2,"option",33),t(),u(30,de,2,0,"div",25),t(),n(31,"div",30)(32,"label",23),l(33,"Zip Code"),t(),E(34,"input",34),u(35,ue,2,0,"div",25),t()(),n(36,"div",20)(37,"button",35),l(38," Save Changes "),t(),n(39,"button",36),A("click",function(){N(i);let d=x();return T(d.cancelEditing())}),l(40," Cancel "),t()()()}if(r&2){let i,s,d,c,f,v,C,g,S,_,y,h,e=x();m("formGroup",e.profileForm),a(4),m("ngClass",b(15,P,((i=e.profileForm.get("username"))==null?null:i.invalid)&&(((i=e.profileForm.get("username"))==null?null:i.touched)||((i=e.profileForm.get("username"))==null?null:i.dirty)))),a(),m("ngIf",((s=e.profileForm.get("username"))==null||s.errors==null?null:s.errors.required)&&(((s=e.profileForm.get("username"))==null?null:s.touched)||((s=e.profileForm.get("username"))==null?null:s.dirty))),a(),m("ngIf",((d=e.profileForm.get("username"))==null||d.errors==null?null:d.errors.minlength)&&(((d=e.profileForm.get("username"))==null?null:d.touched)||((d=e.profileForm.get("username"))==null?null:d.dirty))),a(4),m("ngClass",b(17,P,((c=e.profileForm.get("email"))==null?null:c.invalid)&&(((c=e.profileForm.get("email"))==null?null:c.touched)||((c=e.profileForm.get("email"))==null?null:c.dirty)))),a(),m("ngIf",((f=e.profileForm.get("email"))==null||f.errors==null?null:f.errors.required)&&(((f=e.profileForm.get("email"))==null?null:f.touched)||((f=e.profileForm.get("email"))==null?null:f.dirty))),a(),m("ngIf",((v=e.profileForm.get("email"))==null||v.errors==null?null:v.errors.email)&&(((v=e.profileForm.get("email"))==null?null:v.touched)||((v=e.profileForm.get("email"))==null?null:v.dirty))),a(9),m("ngClass",b(19,P,((C=e.profileForm.get("city"))==null?null:C.invalid)&&(((C=e.profileForm.get("city"))==null?null:C.touched)||((C=e.profileForm.get("city"))==null?null:C.dirty)))),a(),m("ngIf",((g=e.profileForm.get("city"))==null||g.errors==null?null:g.errors.required)&&(((g=e.profileForm.get("city"))==null?null:g.touched)||((g=e.profileForm.get("city"))==null?null:g.dirty))),a(4),m("ngClass",b(21,P,((S=e.profileForm.get("state"))==null?null:S.invalid)&&(((S=e.profileForm.get("state"))==null?null:S.touched)||((S=e.profileForm.get("state"))==null?null:S.dirty)))),a(3),m("ngForOf",e.states),a(),m("ngIf",((_=e.profileForm.get("state"))==null||_.errors==null?null:_.errors.required)&&(((_=e.profileForm.get("state"))==null?null:_.touched)||((_=e.profileForm.get("state"))==null?null:_.dirty))),a(4),m("ngClass",b(23,P,((y=e.profileForm.get("zipCode"))==null?null:y.invalid)&&(((y=e.profileForm.get("zipCode"))==null?null:y.touched)||((y=e.profileForm.get("zipCode"))==null?null:y.dirty)))),a(),m("ngIf",((h=e.profileForm.get("zipCode"))==null||h.errors==null?null:h.errors.required)&&(((h=e.profileForm.get("zipCode"))==null?null:h.touched)||((h=e.profileForm.get("zipCode"))==null?null:h.dirty))),a(2),m("disabled",e.profileForm.invalid||e.isLoading)}}var ee=class r{constructor(o,i,s,d,c){this.userService=o;this.authService=i;this.fb=s;this.toastr=d;this.router=c;this.profileForm=this.fb.group({username:["",[p.required,p.minLength(3)]],email:["",[p.required,p.email]],streetAddress:[""],city:["",p.required],state:["",p.required],zipCode:["",p.required]})}user=null;isEditing=!1;isLoading=!1;profileForm;states=["AL","AK","AZ","AR","CA","CO","CT","DE","FL","GA","HI","ID","IL","IN","IA","KS","KY","LA","ME","MD","MA","MI","MN","MS","MO","MT","NE","NV","NH","NJ","NM","NY","NC","ND","OH","OK","OR","PA","RI","SC","SD","TN","TX","UT","VT","VA","WA","WV","WI","WY"];ngOnInit(){this.loadProfile()}loadProfile(){this.isLoading=!0;let o=this.authService.getUserId();if(!o){this.toastr.error("User not authenticated"),this.isLoading=!1;return}this.userService.getUserById(o).subscribe({next:i=>{this.user=i,this.profileForm.patchValue(i),this.isLoading=!1},error:i=>{this.isLoading=!1,console.error("Profile load error:",i),this.toastr.error("Failed to load profile data"),console.log("Token valid:",this.authService.hasValidToken()),console.log("Token expiration:",this.authService.isTokenExpired())}})}startEditing(){this.isEditing=!0}cancelEditing(){this.isEditing=!1,this.profileForm.patchValue(this.user)}saveProfile(){this.profileForm.invalid||!this.user||(this.isLoading=!0,this.userService.updateUser(this.user.id,this.profileForm.value).subscribe({next:o=>{this.user=o,this.isEditing=!1,this.isLoading=!1,this.toastr.success("Profile updated successfully"),o.username!==this.authService.getUsername()&&this.authService.setUsername(o.username)},error:o=>{this.isLoading=!1,console.error("Profile update error:",o),this.toastr.error("Failed to update profile")}}))}static \u0275fac=function(i){return new(i||r)(F(Q),F(X),F(Z),F($),F(w))};static \u0275cmp=V({type:r,selectors:[["app-profile"]],decls:11,vars:3,consts:[[1,"container","py-5"],[1,"row"],[1,"col-lg-8","mx-auto"],[1,"card","shadow"],[1,"card-header","bg-primary","text-white"],[1,"mb-0"],[1,"card-body"],["class","text-center py-5",4,"ngIf"],["class","user-info",4,"ngIf"],[3,"formGroup","ngSubmit",4,"ngIf"],[1,"text-center","py-5"],["role","status",1,"spinner-border","text-primary"],[1,"visually-hidden"],[1,"mt-2"],[1,"user-info"],[1,"mb-3"],[1,"text-muted"],[1,"h4"],[1,"h5"],["class","h5",4,"ngIf"],[1,"mt-4"],[1,"btn","btn-primary","me-2",3,"click"],[3,"ngSubmit","formGroup"],[1,"form-label"],["type","text","formControlName","username",1,"form-control",3,"ngClass"],["class","invalid-feedback",4,"ngIf"],["type","email","formControlName","email",1,"form-control",3,"ngClass"],["type","text","formControlName","streetAddress",1,"form-control"],[1,"col-md-6","mb-3"],["type","text","formControlName","city",1,"form-control",3,"ngClass"],[1,"col-md-3","mb-3"],["formControlName","state",1,"form-select",3,"ngClass"],["value","","disabled",""],[3,"value",4,"ngFor","ngForOf"],["type","text","formControlName","zipCode",1,"form-control",3,"ngClass"],["type","submit",1,"btn","btn-primary","me-2",3,"disabled"],["type","button",1,"btn","btn-outline-secondary",3,"click"],[1,"invalid-feedback"],[3,"value"]],template:function(i,s){i&1&&(n(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"h3",5),l(6,"User Profile"),t()(),n(7,"div",6),u(8,te,6,0,"div",7)(9,re,20,6,"div",8)(10,pe,41,25,"form",9),t()()()()()),i&2&&(a(8),m("ngIf",s.isLoading),a(),m("ngIf",!s.isEditing&&s.user&&!s.isLoading),a(),m("ngIf",s.isEditing&&s.user&&!s.isLoading))},dependencies:[k,M,O,U,J,j,H,Y,z,W,G,R,B,K,D],encapsulation:2})};export{ee as ProfileComponent};
