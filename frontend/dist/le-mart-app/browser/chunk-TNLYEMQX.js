import{b as f,n as b,o as g}from"./chunk-ICKQEOCD.js";import{C as l,O as v,V as I,_ as O,a as i,b as u,m as h,q as c,w as m}from"./chunk-J2LCUAOM.js";var H=class o{constructor(e,r){this.http=e;this.authService=r}baseUrl=`${b.apiUrl}/orders`;getAuthHeaders(){return this.authService.getAuthHeader()}getUserOrders(e){return this.http.get(`${this.baseUrl}/user/${e}`,{headers:this.getAuthHeaders()}).pipe(v(r=>{if(!r.length)return h([]);let t=r.map(a=>{if(!a.orderItems||!a.orderItems.length)return h(a);let n=a.orderItems.map(s=>this.http.get(`${b.apiUrl}/products/${s.productId}`).pipe(c(d=>u(i({},s),{productName:d.name,productImage:d.imageUrl}))));return m(n).pipe(c(s=>u(i({},a),{orderItems:s})))});return m(t)}))}getOrderById(e){return this.http.get(`${this.baseUrl}/${e}`,{headers:this.getAuthHeaders()})}createOrder(e){let r=u(i({},e),{status:e.status||"PENDING"});return this.http.post(this.baseUrl,r,{headers:this.getAuthHeaders()}).pipe(l(t=>{throw console.error("Detailed error:",t),t}))}updateOrderStatus(e,r){let t={status:r};return this.http.patch(`${this.baseUrl}/${e}/status`,t,{headers:this.getAuthHeaders()})}deleteOrder(e){return this.http.delete(`${this.baseUrl}/${e}`,{headers:this.getAuthHeaders()})}convertCartToOrder(e,r,t,a,n,s){let d={userId:e,orderItems:r.map(p=>({productId:p.productId,quantity:p.quantity,priceAtPurchase:p.currentPrice})),subtotal:t,tax:a,shipping:n,totalAmount:s};return this.createOrder(d)}static \u0275fac=function(r){return new(r||o)(O(f),O(g))};static \u0275prov=I({token:o,factory:o.\u0275fac,providedIn:"root"})};export{H as a};
