import{p as H,q as F,r as j}from"./chunk-Q7GZBL2D.js";import{a as R}from"./chunk-TNLYEMQX.js";import{h as B}from"./chunk-OZSZ3DCI.js";import{j as D,m as A,o as L}from"./chunk-ICKQEOCD.js";import{l as T,m as k,n as w,p as C,q as x}from"./chunk-66TIHPRD.js";import{Db as f,Eb as v,Hb as P,Mb as n,Nb as _,Ob as l,Pa as I,Ra as a,Xa as u,Yb as m,Zb as s,_b as N,ab as b,ga as S,gb as g,ha as h,nb as c,rb as M,sb as i,tb as t,ub as O,yb as E}from"./chunk-J2LCUAOM.js";var y=class d{constructor(r){this.activeModal=r}orderId;orderTotal;static \u0275fac=function(e){return new(e||d)(u(H))};static \u0275cmp=b({type:d,selectors:[["app-confirm-cancel-modal"]],decls:15,vars:4,consts:[[1,"modal-header"],[1,"modal-title"],["type","button","aria-label","Close",1,"btn-close",3,"click"],[1,"modal-body"],[1,"modal-footer"],["type","button",1,"btn","btn-outline-secondary",3,"click"],["type","button",1,"btn","btn-danger",3,"click"]],template:function(e,o){e&1&&(i(0,"div",0)(1,"h4",1),n(2,"Confirm Order Cancellation"),t(),i(3,"button",2),f("click",function(){return o.activeModal.dismiss()}),t()(),i(4,"div",3)(5,"p"),n(6),t(),i(7,"p"),n(8),m(9,"currency"),t()(),i(10,"div",4)(11,"button",5),f("click",function(){return o.activeModal.dismiss()}),n(12,"No, Keep Order"),t(),i(13,"button",6),f("click",function(){return o.activeModal.close("confirm")}),n(14,"Yes, Cancel Order"),t()()),e&2&&(a(6),l("Are you sure you want to cancel order #",o.orderId,"?"),a(2),l("Total amount: ",s(9,2,o.orderTotal),""))},dependencies:[x,C],styles:[".modal-header[_ngcontent-%COMP%]{background-color:#f8f9fa;border-bottom:1px solid #dee2e6;padding:1rem}.modal-header[_ngcontent-%COMP%]   .modal-title[_ngcontent-%COMP%]{margin:0;font-size:1.25rem}.modal-body[_ngcontent-%COMP%]{padding:1.5rem}.modal-body[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin-bottom:.5rem}.modal-body[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]:last-child{font-weight:700}.modal-footer[_ngcontent-%COMP%]{border-top:1px solid #dee2e6;padding:1rem;display:flex;justify-content:flex-end;gap:.5rem}"]})};function Y(d,r){d&1&&(i(0,"div",7)(1,"div",8)(2,"span",9),n(3,"Loading..."),t()(),i(4,"p",10),n(5,"Loading your orders..."),t()())}function K(d,r){if(d&1){let e=E();i(0,"div",11),n(1," Failed to load orders. Please try again later. "),i(2,"button",12),f("click",function(){S(e);let p=v();return h(p.loadOrders())}),n(3,"Retry"),t()()}}function Q(d,r){d&1&&(i(0,"div",7),O(1,"i",13),i(2,"h3",14),n(3,"No orders found"),t(),i(4,"p",15),n(5,"You haven't placed any orders yet"),t(),i(6,"a",16),n(7,"Start Shopping"),t()())}function J(d,r){if(d&1&&(i(0,"tr")(1,"td")(2,"div",30),O(3,"img",31),n(4),t()(),i(5,"td"),n(6),t(),i(7,"td"),n(8),m(9,"currency"),t(),i(10,"td"),n(11),m(12,"currency"),t()()),d&2){let e=r.$implicit;a(3),P("alt",e.productName),c("src",e.productImage||"assets/img/placeholder.jpg",I),a(),l(" ",e.productName||"Product #"+e.productId," "),a(2),_(e.quantity),a(2),_(s(9,6,e.priceAtPurchase)),a(3),_(s(12,8,e.priceAtPurchase*e.quantity))}}function W(d,r){if(d&1){let e=E();i(0,"button",32),f("click",function(){S(e);let p=v().$implicit,G=v(2);return h(G.openCancelModal(p))}),n(1," Cancel Order "),t()}}function X(d,r){if(d&1&&(i(0,"div",19)(1,"div",20)(2,"div")(3,"h5",21),n(4),t(),i(5,"small",15),n(6),m(7,"date"),t()(),i(8,"span"),n(9),t()(),i(10,"div",22)(11,"div",23)(12,"strong"),n(13,"Subtotal:"),t(),n(14),m(15,"currency"),t(),i(16,"div",23)(17,"strong"),n(18,"Shipping:"),t(),n(19),m(20,"currency"),t(),i(21,"div",23)(22,"strong"),n(23,"Total:"),t(),n(24),m(25,"currency"),t()(),i(26,"div",24)(27,"h6"),n(28,"Items:"),t(),i(29,"div",25)(30,"table",26)(31,"thead")(32,"tr")(33,"th"),n(34,"Product"),t(),i(35,"th"),n(36,"Quantity"),t(),i(37,"th"),n(38,"Price"),t(),i(39,"th"),n(40,"Total"),t()()(),i(41,"tbody"),g(42,J,13,10,"tr",27),t()()()(),i(43,"div",28),g(44,W,2,0,"button",29),t()()),d&2){let e=r.$implicit,o=v(2);a(4),l("Order #",e.id,""),a(2),l(" Placed on ",N(7,11,e.createdAt,"medium")," "),a(2),M("badge rounded-pill ",o.getStatusClass(e.status),""),a(),l(" ",e.status," "),a(5),l(" ",s(15,14,e.subtotal)," "),a(5),l(" ",s(20,16,e.shipping)," "),a(5),l(" ",s(25,18,e.totalAmount)," "),a(18),c("ngForOf",e.orderItems),a(2),c("ngIf",o.canCancel(e))}}function Z(d,r){if(d&1&&(i(0,"div",17),g(1,X,45,20,"div",18),t()),d&2){let e=v();a(),c("ngForOf",e.orders)}}var V=class d{constructor(r,e,o,p){this.orderService=r;this.authService=e;this.toastr=o;this.modalService=p}orders=[];loading=!0;error=!1;ngOnInit(){this.loadOrders()}loadOrders(){this.loading=!0,this.error=!1;let r=this.authService.getUserId();this.orderService.getUserOrders(r).subscribe({next:e=>{this.orders=e,this.loading=!1},error:e=>{console.error("Error loading orders",e),this.error=!0,this.loading=!1,this.toastr.error("Failed to load orders")}})}canCancel(r){return r.status==="PENDING"||r.status==="PROCESSING"}openCancelModal(r){if(!this.canCancel(r))return;let e=this.modalService.open(y);e.componentInstance.orderId=r.id,e.componentInstance.orderTotal=r.totalAmount,e.result.then(o=>{o==="confirm"&&this.cancelOrder(r.id)}).catch(()=>{})}cancelOrder(r){this.orderService.updateOrderStatus(r,"CANCELLED").subscribe({next:()=>{this.toastr.success("Order cancelled successfully"),this.loadOrders()},error:e=>{console.error("Error cancelling order",e),this.toastr.error("Failed to cancel order")}})}getStatusClass(r){switch(r){case"PENDING":return"text-bg-warning";case"PROCESSING":return"text-bg-primary";case"SHIPPED":return"text-bg-info";case"DELIVERED":case"COMPLETED":return"text-bg-success";case"CANCELLED":return"text-bg-danger";default:return"text-bg-secondary"}}static \u0275fac=function(e){return new(e||d)(u(R),u(L),u(B),u(F))};static \u0275cmp=b({type:d,selectors:[["app-order-history"]],decls:9,vars:4,consts:[[1,"container","py-5"],[1,"row"],[1,"col-12"],[1,"mb-4"],["class","text-center py-5",4,"ngIf"],["class","alert alert-danger",4,"ngIf"],["class","list-group",4,"ngIf"],[1,"text-center","py-5"],["role","status",1,"spinner-border","text-primary"],[1,"visually-hidden"],[1,"mt-2"],[1,"alert","alert-danger"],[1,"btn","btn-sm","btn-outline-danger","ms-3",3,"click"],[1,"bi","bi-box-seam","display-1","text-muted"],[1,"mt-3"],[1,"text-muted"],["routerLink","/",1,"btn","btn-primary"],[1,"list-group"],["class","list-group-item mb-3",4,"ngFor","ngForOf"],[1,"list-group-item","mb-3"],[1,"d-flex","justify-content-between","align-items-center","mb-2"],[1,"mb-0"],[1,"row","mb-3"],[1,"col-md-4"],[1,"mb-3"],[1,"table-responsive"],[1,"table","table-sm"],[4,"ngFor","ngForOf"],[1,"d-flex","justify-content-end"],["class","btn btn-outline-danger me-2",3,"click",4,"ngIf"],[1,"d-flex","align-items-center"],[1,"img-fluid","rounded","me-2",2,"width","50px","height","50px","object-fit","cover",3,"src","alt"],[1,"btn","btn-outline-danger","me-2",3,"click"]],template:function(e,o){e&1&&(i(0,"div",0)(1,"div",1)(2,"div",2)(3,"h1",3),n(4,"My Orders"),t(),g(5,Y,6,0,"div",4)(6,K,4,0,"div",5)(7,Q,8,0,"div",4)(8,Z,2,1,"div",6),t()()()),e&2&&(a(5),c("ngIf",o.loading),a(),c("ngIf",o.error&&!o.loading),a(),c("ngIf",!o.loading&&!o.error&&o.orders.length===0),a(),c("ngIf",!o.loading&&!o.error&&o.orders.length>0))},dependencies:[x,T,k,C,w,A,D,j],encapsulation:2})};export{V as OrderHistoryComponent};
